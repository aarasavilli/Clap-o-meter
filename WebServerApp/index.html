<!doctype html>
<html>
  <head>
    <title>CLAP-O-METER</title>
    <link rel="stylesheet" type="text/css" href="/odometer-theme-plaza.css">
	<link rel="stylesheet" type="text/css" href="/style.css">
    <script src="/style.css"></script>
	<script src="/odometer.js"></script>
	<script src="/gauge.js"></script>
	<script src="/socket.io-1.2.0.js"></script>
	<script src="/jquery-latest.min.js"></script>
    <script src="/highcharts.js"></script>
    <script src="/exporting.js"></script>

  </head>
  
  <body>
	<div><h2>CLAP-'O'-METER</h2></div>
	
	<div style="margin-top:10px;">
	<div id="preview" style="text-align: center;">
  	<canvas width="300" height="200" id="foo"></canvas>
  	</div>
	<div style="text-align: center;">
  <span style="color: #ffffff;"><h3>Clap Count</h3></span>
  <div id="odo" class="odometer"> </div>
</div>
<div style="text-align:center;margin-top:20px">
<select id="combobox"   onchange="selectquestion()" style="width:500px;border:3px solid;border-radius:5px;allign:center">
 <option value="none">Select Question</option>
</select>
</div>
<div style="text-align:center">
<div id="container" style="width: 800px; height: 400px; margin-top:60px;margin-bottom:0px;margin-right:auto;margin-left:auto"></div>
</div>
</div>
	  	<input type='text' id='selectedName'>Name</input>
	<button onclick = 'updateNameChange()'>Update</button>
<script>

var socket = io.connect();
var gauge;
var initialDate =  new Date().getTime();
	var opts = {
  lines: 12, // The number of lines to draw
  angle: 0.15, // The length of each line
  lineWidth: 0.44, // The line thickness
  pointer: {
    length: 0.9, // The radius of the inner circle
    strokeWidth: 0.035, // The rotation offset
    color: '#000000' // Fill color
  },
  limitMax: 'false',   // If true, the pointer will not go past the end of the gauge
  colorStart: '#6FADCF',   // Colors
  colorStop: '#8FC0DA',    // just experiment with them
  strokeColor: '#E0E0E0',   // to see which ones work best for you
  generateGradient: true
};
var target = document.getElementById('foo'); // your canvas element
gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
gauge.maxValue = 30; // set max gauge value
gauge.animationSpeed = 43; // set animation speed (32 is default value)

	socket.on('dataForGraphToUI',function(data){
		dataForGraph = data;
		console.log('Data from client------:'+dataForGraph);
		chart.series[0].setData(dataForGraph);
	});

socket.on('updateClapinUI',function(counter){
		
		gauge.set(counter);
		document.getElementById('odo').innerHTML = counter;
    });
	
	//update barchart on each question event
	socket.on('UpdateQuestionResponseinUI',function(id,result){
	console.log(id+""+result);
	if(!$("#container").is(':visible'))
	{
	console.log("visible"+$("#container").is(':visible'));
	$('#container').show();
	$('#combobox').show();
	}
			$('#container').show();

	var questionno=id+1;
	questionno="Ques."+questionno;
	addoptiontoCombo(""+questionno);			
	console.log(result.question+result.yesCount+result.noCount+result.dontCareCount);
	var dataForGraph;
	if($('#combobox :selected').text()==="Select Question")
	{
	console.log("inside combobox if");
	aa(result.question,result.yesCount,result.noCount,result.dontCareCount,result.notAnswered);
	}
    });
	socket.on('gotresponseforquestionselectedOnUI',function(result){
		aa(result.question,result.yesCount,result.noCount,result.dontCareCount,result.notAnswered);
	});
	
	
	function getCounterValue() {
		socket.emit('event:get:countervalue',function(counterValue) {
				alert('call back called'+counterValue);
		});
	}
	function addoptiontoCombo(questionno) {
    var combo = document.getElementById("combobox");
     
    var option = document.createElement("option");
    option.text = questionno;
    option.value = questionno;
    try {
	console.log($("#combobox option[value='"+questionno+"']").length > 0);
	if(!$("#combobox option[value='"+questionno+"']").length > 0)
	{
        combo.add(option, null); //Standard 
	}
    }catch(error) {
	if(!$("#combobox option[value='yourValue']").length > 0)
	{
        combo.add(option); // IE only
	}
       
    }
   questionno= "";
}

	
	function selectquestion() {
	var selectedquestion=$('#combobox :selected').text();
	var split=selectedquestion.split(".")
    var selectedquestionid = split[1]-1;
	//alert(selectedquestionid);
		if(selectedquestionid || selectedquestionid === 0) {
			socket.emit('event:sendquestionselected',selectedquestionid);
		}
	}
   
   
function aa(question,yescnt,nocnt,dontcarecnt,notanswered) {
	
		var chartData = [yescnt, nocnt, dontcarecnt,notanswered];
		 chart.setTitle({
         text: question
        });
		chart.series[0].setData(dataForGraph);
		
	

	}
	
	//added by sonal
	var chart;

$(function () {
	// create chart
	

	//$('#container').hide();
	$('#combobox').hide();
	chart = new Highcharts.Chart({
        chart: {
		renderTo: 'container',
            type: 'StockChart'
        },
        title: {
            text: 'Response Count'
        },
        xAxis: {
			  gapGridLineWidth: 0
            //categories: ['Yes', 'No', 'Dont Care','Not Answered']
			
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total count response'
            }
        },
        legend: {
            reversed: true
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
		
        series: [{
            name: 'QuestionClapedCount',
			type: 'area',
			gapSize: 5,
            data: [15, 20, 40, 20]
        }]
    });

	
	
	//setInterval(aa, 2000);
	
 
});
	
	function updateNameChange() {
		socket.emit('nameChanged', document.getElementById('selectedName').value);
				chart.series[0].setData(dataForGraph);
		var currentTime =  initialDate - new Date().getTime(); 
		//alert('time'+currentTime+'Xaxis value'+chart.xAxis.tick);
		//chart.xAxis[0].addPlotBand();

	}
	
	

		
	</script>
  </body>
	

</html>
