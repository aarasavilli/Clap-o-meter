<!doctype html>
<html>
  <head>
    <title>CLAP-O-METER</title>
    <link rel="stylesheet" type="text/css" href="/odometer-theme-plaza.css">

	<script src="/odometer.js"></script>
	<script src="/gauge.js"></script>
	<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>
	<script src="http://code.jquery.com/jquery-latest.min.js" type="text/javascript"></script>
     <script src="http://code.highcharts.com/highcharts.js"></script>
     <script src="http://code.highcharts.com/modules/exporting.js"></script>

  </head>
  
  <body>
	<div style="text-align: center;"><img  width="300" height="75"src="/download.jpg"></div>
	
	<div style="margin-top:10px;">
	<div id="preview" style="text-align: center;">
  	<canvas width="300" height="200" id="foo"></canvas>
  	</div>
	<div style="text-align: center;">
  <span style="color: #648baf;"><h4>Clap Count</h4></span>
  <div id="odo" class="odometer"> </div>
</div>
<div style="text-align:center;margin-top:10px">
<select id="combobox"   onchange="selectquestion()" style="width:500px;border:3px solid;border-radius:5px;allign:center">
 <option value="none">Select Question</option>
</select>
</div>
<div id="container" style="margin-top:20px;min-width: 310px; margin-top:10px;max-width: 800px; height: 400px; margin: 0 auto"></div>

</div>
<script>

var socket = io.connect();
var gauge;

	var opts = {
  lines: 12, // The number of lines to draw
  angle: 0.15, // The length of each line
  lineWidth: 0.44, // The line thickness
  pointer: {
    length: 0.9, // The radius of the inner circle
    strokeWidth: 0.035, // The rotation offset
    color: '#000000' // Fill color
  },
  limitMax: 'false',   // If true, the pointer will not go past the end of the gauge
  colorStart: '#6FADCF',   // Colors
  colorStop: '#8FC0DA',    // just experiment with them
  strokeColor: '#E0E0E0',   // to see which ones work best for you
  generateGradient: true
};
var target = document.getElementById('foo'); // your canvas element
gauge = new Gauge(target).setOptions(opts); // create sexy gauge!
gauge.maxValue = 30; // set max gauge value
gauge.animationSpeed = 43; // set animation speed (32 is default value)



socket.on('updateClapinUI',function(counter){
		
		gauge.set(counter);
		document.getElementById('odo').innerHTML = counter;
    });
	
	//update barchart on each question event
	socket.on('UpdateQuestionResponseinUI',function(id,result){
	console.log(id+""+result);
	if(!$("#container").is(':visible'))
	{
	console.log("visible"+$("#container").is(':visible'));
	$('#container').show();
	$('#combobox').show();
	}
	var questionno=id+1;
	questionno="Ques."+questionno;
	addoptiontoCombo(""+questionno);			
	console.log(result.question+result.yesCount+result.noCount+result.dontCareCount);
	aa(result.question,result.yesCount,result.noCount,result.dontCareCount);
    });
	socket.on('gotresponseforquestionselected',function(result){
	var jsonresult = JSON.parse(result);
			aa(jsonresult.question,jsonresult.yescount,jsonresult.nocount,jsonresult.dontcarecount);
	});
	
	
	function getCounterValue() {
		socket.emit('event:get:countervalue',function(counterValue) {
				alert('call back called'+counterValue);
		});
	}
	function addoptiontoCombo(questionno) {
    var combo = document.getElementById("combobox");
     
    var option = document.createElement("option");
    option.text = questionno;
    option.value = questionno;
    try {
        combo.add(option, null); //Standard 
    }catch(error) {
        combo.add(option); // IE only
    }
   questionno= "";
}

	
	function selectquestion() {
	var selectedquestion=$('#combobox :selected').text();
	alert(selectedquestion.split("."));
      socket.emit('event:sendquestionselected',function(selectedquestion) {
                    });
		}
   
   
function aa(question,yescnt,nocnt,dontcarecnt) {
	
		var chartData = [yescnt, nocnt, dontcarecnt];
		//var chartData = [130, 100, 150];
		// this is how we set the data of chart
		// note: on top, "chart" variable is declared
		 chart.setTitle({
            text: question
        });
		chart.series[0].setData(chartData);
		
	

	}
	
	//added by sonal
	var chart;

$(function () {
	// create chart
	

	$('#container').hide();
	$('#combobox').hide();
	chart = new Highcharts.Chart({
        chart: {
		renderTo: 'container',
            type: 'column'
        },
        title: {
            text: 'Response Count'
        },
        xAxis: {
            categories: ['Yes', 'No', 'Dont Care']
        },
        yAxis: {
            min: 0,
            title: {
                text: 'Total count response'
            }
        },
        legend: {
            reversed: true
        },
        plotOptions: {
            series: {
                stacking: 'normal'
            }
        },
        series: [{
            name: 'QuestionClapedCount',
            data: [15, 20, 40]
        }]
    });

	
	
	//setInterval(aa, 2000);
	
 
});
	</script>
  </body>
	

</html>
